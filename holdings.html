<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Holdings Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-950 text-gray-100 min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-gray-900 border-b border-gray-800">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="text-2xl font-bold text-cyan-400">StockExpress</div>
      <nav class="space-x-6 text-gray-300 font-medium text-sm">
        <a href="#" class="hover:text-cyan-400 transition">Home</a>
        <a href="stocks.html" class="hover:text-cyan-400 transition">Stocks</a>
      </nav>
    </div>
  </header>

  <!-- Profile -->
  <section class="max-w-7xl mx-auto px-6 py-4">
    <div class="flex items-center space-x-4 bg-gray-900 border border-gray-800 rounded-lg p-4 shadow">
      <div class="w-12 h-12 rounded-full bg-cyan-500 flex items-center justify-center text-xl font-bold text-gray-900">A</div>
      <div>
        <div class="text-lg font-semibold text-white">Abhishek Samanta</div>
        <div class="text-sm text-gray-400">Balance: â‚¹45,891</div>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <main class="flex-1 px-6 py-6 space-y-10">
    <!-- Charts + Table -->
    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Charts -->
      <div class="space-y-6 lg:col-span-1">
        <div class="bg-gray-900 p-4 rounded-lg shadow border border-gray-800">
          <h2 class="text-md font-semibold mb-3 text-cyan-400">ðŸ“Š Stock Quantity</h2>
          <div class="h-64">
            <canvas id="barChart"></canvas>
          </div>
        </div>
        <div class="bg-gray-900 p-4 rounded-lg shadow border border-gray-800">
          <h2 class="text-md font-semibold mb-3 text-cyan-400">ðŸ¥§ Investment Split</h2>
          <div class="h-64">
            <canvas id="pieChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Holdings Table -->
      <div class="lg:col-span-2">
        <div class="bg-gray-900 border border-gray-800 rounded-xl shadow-lg overflow-hidden">
          <table class="min-w-full table-auto text-sm text-left">
            <thead class="bg-gray-800 text-cyan-300 uppercase text-xs font-semibold">
              <tr>
                <th class="px-6 py-4">Company</th>
                <th class="px-6 py-4">Quantity</th>
                <th class="px-6 py-4">Bought Price</th>
                <th class="px-6 py-4">Current Price</th>
                <th class="px-6 py-4">Profit/Loss</th>
                <th class="px-6 py-4">Realised</th>
                <th class="px-6 py-4">Actions</th>
              </tr>
            </thead>
            <tbody id="holdings-table-body" class="divide-y divide-gray-800">
              <!-- Dynamic Rows -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Profit/Loss Chart -->
    <div class="max-w-7xl mx-auto">
      <div class="bg-gray-900 p-6 rounded-lg shadow border border-gray-800 mt-6">
        <h2 class="text-md font-semibold mb-3 text-cyan-400">ðŸ“‰ Profit / Loss Per Company</h2>
        <div class="h-72">
          <canvas id="profitChart"></canvas>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-gray-500 text-sm py-4 text-center border-t border-gray-800 mt-10">
    &copy; 2025 StockExpress â€¢ Auto-refresh every 1 minute
  </footer>

  <!-- JavaScript -->
  <script>
    let barChart, pieChart, profitChart;

    async function loadHoldings() {
      try {
        const res = await fetch("http://localhost:5000/holdings");
        const data = await res.json();

        const tableBody = document.getElementById("holdings-table-body");
        tableBody.innerHTML = '';

        const labels = [], quantities = [], investments = [], profits = [];

        data.forEach((holding, index) => {
          const profitColor = holding.profit_loss >= 0 ? 'text-green-400' : 'text-red-400';
          const row = document.createElement("tr");
          row.className = "hover:bg-gray-800 transition-colors duration-200";
          row.innerHTML = `
            <td class="px-6 py-4 text-cyan-200 font-medium">${holding.company_name}</td>
            <td class="px-6 py-4">${holding.quantity}</td>
            <td class="px-6 py-4">â‚¹${holding.buy_price}</td>
            <td class="px-6 py-4">â‚¹${holding.current_price}</td>
            <td class="px-6 py-4 font-semibold ${profitColor}">â‚¹${holding.profit_loss}</td>
            <td class="px-6 py-4">â‚¹${holding.realised_price}</td>
            <td class="px-6 py-4">
              <button onclick="sellStock(${index})" class="bg-cyan-600 hover:bg-cyan-500 text-white text-xs font-semibold px-4 py-2 rounded-lg transition-all duration-150">
                Sell
              </button>
            </td>
          `;
          tableBody.appendChild(row);

          labels.push(holding.company_name);
          quantities.push(holding.quantity);
          investments.push(holding.quantity * holding.buy_price);
          profits.push(holding.profit_loss);
        });

        renderCharts(labels, quantities, investments, profits);
      } catch (error) {
        console.error("Error loading holdings:", error);
      }
    }

    function renderCharts(labels, quantities, investments, profits) {
      const colors = ['#06b6d4', '#8b5cf6', '#f59e0b', '#10b981', '#ef4444', '#eab308', '#6366f1'];

      if (barChart) barChart.destroy();
      barChart = new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'Quantity',
            data: quantities,
            backgroundColor: colors
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            y: { beginAtZero: true, ticks: { color: '#9ca3af' } },
            x: { ticks: { color: '#9ca3af' } }
          }
        }
      });

      if (pieChart) pieChart.destroy();
      pieChart = new Chart(document.getElementById('pieChart'), {
        type: 'pie',
        data: {
          labels,
          datasets: [{
            label: 'Investment',
            data: investments,
            backgroundColor: colors
          }]
        },
        options: {
          plugins: {
            legend: {
              labels: { color: '#9ca3af' }
            }
          }
        }
      });

      if (profitChart) profitChart.destroy();
      profitChart = new Chart(document.getElementById('profitChart'), {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'Profit / Loss',
            data: profits,
            backgroundColor: profits.map(p => p >= 0 ? '#10b981' : '#ef4444')
          }]
        },
        options: {
          indexAxis: 'y',
          plugins: {
            legend: { display: false },
          },
          scales: {
            x: { ticks: { color: '#9ca3af' }, beginAtZero: true },
            y: { ticks: { color: '#9ca3af' } }
          }
        }
      });
    }

    function sellStock(index) {
      alert(`Sell stock at row ${index + 1}`);
      // Add your sell logic here
    }

    window.onload = loadHoldings;
    setInterval(() => location.reload(), 60000);
  </script>
</body>
</html>
