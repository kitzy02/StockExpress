<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Watchlist - Stock Express</title>
  <link rel="icon" href="/favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .logo-icon { animation: pulse 2s infinite; }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .navbar-blur {
      backdrop-filter: blur(20px);
      background: rgba(185, 178, 138, 0.95);
    }
    .table-container {
      background: linear-gradient(145deg, rgba(248,243,217,0.95), rgba(235,229,194,0.9));
      border: 1px solid rgba(185,178,138,0.3);
      backdrop-filter: blur(10px);
      border-radius: 1.5rem;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(80, 75, 56, 0.1);
    }
    .watchlist-table {
      width: 100%;
      border-collapse: collapse;
    }
    .watchlist-table th {
      background: linear-gradient(135deg, #504B38, #3d3829);
      color: #F8F3D9;
      padding: 1rem;
      font-size: 0.875rem;
      text-align: left;
    }
    .watchlist-table td {
      padding: 1rem;
      color: #504B38;
      font-weight: 500;
    }
    .watchlist-table tr:nth-child(even) {
      background-color: rgba(248, 243, 217, 0.4);
    }
    .remove-btn {
      background: linear-gradient(135deg, #B91C1C, #7F1D1D);
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 0.75rem;
      font-weight: 600;
      font-size: 0.875rem;
      transition: all 0.3s ease;
    }
    .remove-btn:hover {
      background: linear-gradient(135deg, #DC2626, #991B1B);
      transform: translateY(-2px);
    }
    .toast {
      background: linear-gradient(135deg, #504B38, #3d3829);
      color: #F8F3D9;
      border-radius: 0.75rem;
      box-shadow: 0 10px 25px rgba(80, 75, 56, 0.3);
    }
  </style>
</head>

<body class="bg-[#F8F3D9] text-[#504B38] min-h-screen flex flex-col">
  <!-- Navbar -->
  <nav class="navbar-blur py-4 px-6 shadow-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <svg class="w-8 h-8 logo-icon" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="40" height="40" rx="8" fill="#504B38"/>
          <path d="M12 24L16 20L20 22L28 14" stroke="#F8F3D9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="28" cy="14" r="2" fill="#B9B28A"/>
        </svg>
        <h1 class="text-2xl font-bold text-[#504B38]">Stock Express</h1>
      </div>
      <ul class="flex gap-8 font-semibold text-[#504B38]">
        <li><a href="index.html">Home</a></li>
        
        <li><a href="stocks.html" >Stocks</a></li>
        <li><a href="holdings.html">Holdings</a></li>
        <li><a href="index.html" class="btn-dashboard">Log Out</a></li>
      </ul>
    </div>
  </nav>

  <!-- Header -->
  <main class="flex-1 px-6 py-6">
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-[#333024] mb-2">⭐ Watchlist</h1>
    </div>

    <!-- Table -->
    <div class="table-container overflow-x-auto">
      <table class="watchlist-table w-full">
        <thead>
          <tr>
            <th>Company</th>
            <th>Price</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="watchlistBody"></tbody>
      </table>
    </div>
  </main>

  <!-- Toast -->
  <div id="removeToast" class="fixed bottom-6 right-6 toast px-4 py-2 hidden">Removed from watchlist</div>

  <!-- Footer -->
  <footer class="bg-[#504B38] text-[#F8F3D9] py-6 px-6">
    <div class="max-w-6xl mx-auto flex justify-between items-center text-sm">
      <span>© 2025 Stock Express</span>
      <span>Live synced with database</span>
    </div>
  </footer>

  <!-- JS -->
  <script>
    async function fetchWatchlist() {
      try {
        const res = await fetch('http://localhost:5000/watchlist');
        const data = await res.json();
        const tbody = document.getElementById('watchlistBody');
        tbody.innerHTML = '';

        data.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${item.company_name}</td>
              <td>₹${item.price}</td>
              <td>
                <button class="remove-btn" onclick="removeFromWatchlist(${item.watch_id}, '${item.company_name}')">Remove</button>
              </td>
            `;
            tbody.appendChild(row);
          });
          
      } catch (err) {
        console.error('Error fetching watchlist:', err);
      }
    }

    function removeFromWatchlist(watchId, companyName) {
        fetch(`http://localhost:5000/watchlist/remove/${watchId}`, {
          method: 'DELETE'
        })
        .then(res => {
          if (!res.ok) throw new Error(`Error ${res.status}`);
          return res.json();
        })
        .then(() => {
          const toast = document.getElementById('removeToast');
          toast.innerText = `✔ Removed ${companyName} from Watchlist`;
          toast.classList.remove('hidden');
          setTimeout(() => toast.classList.add('hidden'), 4000);
          fetchWatchlist(); // Refresh the table
        })
        .catch(error => {
          alert('❌ Failed to remove from watchlist');
          console.error(error);
        });
      }
          
    fetchWatchlist();
  </script>
</body>
</html>
